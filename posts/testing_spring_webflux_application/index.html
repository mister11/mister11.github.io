<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Testing Spring WebFlux Applications"><meta itemprop=description content="Updated at 25 Feb 2021
Despite this blog post being created recently, I wanted to stick with the same library version as in the blog post that precedes it so that there are no changes due to API evolution. However, I&rsquo;ve created an up-to-date branch where code from this blog post is migrated to the new Spring Data R2DBC API and I&rsquo;ll do my best to keep it up-to-date.
Overview In the last blog post, we&rsquo;ve seen how to use Project Reactor and Spring Webflux to create a reactive Spring application that exposes an endpoint, fetches some data from a database, calls third-party API to get the additional information, and then returns everything as a JSON."><meta itemprop=datePublished content="2021-02-24T00:00:00+00:00"><meta itemprop=dateModified content="2021-02-24T00:00:00+00:00"><meta itemprop=wordCount content="4043"><meta itemprop=keywords content><meta property="og:title" content="Testing Spring WebFlux Applications"><meta property="og:description" content="Updated at 25 Feb 2021
Despite this blog post being created recently, I wanted to stick with the same library version as in the blog post that precedes it so that there are no changes due to API evolution. However, I&rsquo;ve created an up-to-date branch where code from this blog post is migrated to the new Spring Data R2DBC API and I&rsquo;ll do my best to keep it up-to-date.
Overview In the last blog post, we&rsquo;ve seen how to use Project Reactor and Spring Webflux to create a reactive Spring application that exposes an endpoint, fetches some data from a database, calls third-party API to get the additional information, and then returns everything as a JSON."><meta property="og:type" content="article"><meta property="og:url" content="https://mister11.github.io/posts/testing_spring_webflux_application/"><meta property="article:published_time" content="2021-02-24T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-24T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Testing Spring WebFlux Applications"><meta name=twitter:description content="Updated at 25 Feb 2021
Despite this blog post being created recently, I wanted to stick with the same library version as in the blog post that precedes it so that there are no changes due to API evolution. However, I&rsquo;ve created an up-to-date branch where code from this blog post is migrated to the new Spring Data R2DBC API and I&rsquo;ll do my best to keep it up-to-date.
Overview In the last blog post, we&rsquo;ve seen how to use Project Reactor and Spring Webflux to create a reactive Spring application that exposes an endpoint, fetches some data from a database, calls third-party API to get the additional information, and then returns everything as a JSON."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Testing Spring WebFlux Applications</title><link rel=stylesheet href=https://mister11.github.io/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://mister11.github.io/>Random Developer's Blog</a></div><nav class="site-nav hide-in-mobile"><a href=https://mister11.github.io/posts/>Posts</a>
<a href=https://mister11.github.io/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://github.com/mister11 target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/mist3er11 target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://www.linkedin.com/in/mister11/ target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://mister11.github.io/posts/>Posts</a></li><li><a href=https://mister11.github.io/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>24 Feb 2021</span></div><h1>Testing Spring WebFlux Applications</h1></header><div class=content><p><em>Updated at 25 Feb 2021</em></p><p>Despite this blog post being created recently, I wanted to stick with the same library version as in the blog post that precedes it so that there are no changes due to API evolution. However, I&rsquo;ve created an up-to-date <a href=https://github.com/mister11/webflux-demo/tree/up-to-date-version>branch</a> where code from this blog post is migrated to the new Spring Data R2DBC API and I&rsquo;ll do my best to keep it up-to-date.</p><h1 id=overview>Overview<a href=#overview class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>In the last blog post, we&rsquo;ve seen how to use Project Reactor and Spring Webflux to create a reactive Spring application that exposes an endpoint, fetches some data from a database, calls third-party API to get the additional information, and then returns everything as a JSON. In this post, we will look at how can we test each of those components, but also how can we test altogether. Since this will be the last post in the series of posts about the reactive paradigm in Spring, here&rsquo;s the list of all previous posts if you&rsquo;ve missed them and want to gain a better understanding of the content presented in this post:</p><ul><li><a href=https://mister11.github.io/posts/hello_reactive_streams/>Part 1: Hello, Reactive Streams!</a></li><li><a href=https://mister11.github.io/posts/project_reactor_intro/>Part 2: Introduction to Project Reactor</a></li><li><a href=https://mister11.github.io/posts/spring_webflux/>Part 3: Spring WebFlux Introduction</a></li></ul><p>Before we get started, we will need the latest version of the sample project from the previous post which is available <a href=https://github.com/mister11/webflux-demo/tree/step5_finale>here</a>. One difference from the previous post to this one is that there will be only one new branch for all the tests - there will still be multiple steps that we will go through, but you&rsquo;d usually do them in one go so it makes sense to bundle everything together.</p><h1 id=first-steps>First steps<a href=#first-steps class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>You might notice that our whole application resides in one file. Granted, it&rsquo;s only 70 lines of code, but it&rsquo;s a sample application and you will never have a case like that in the real life. Also, having everything in one place hides application layers and ties them together making any future changes potentially costly. I&rsquo;m not going to talk in details about how to incorporate clean architecture or domain-driven design into this application since that&rsquo;s a topic for another blog post, but we will end up with something that resembles clean architecture, is separated by layers, and is easily testable which should always be an end goal.</p><p>To start separating an application into layers, we have to understand what our application does and what it uses to achieve that. The easiest way to understand that is to look at the use-cases that our application contains. In our case, there&rsquo;s only one - fetch all languages from a database, fill in details from the third-party API and return that result to the user. From this, we can extract few layers: a web layer that exposes the API for others to interact with the application, a domain logic layer that it getting data from different sources and combines them, a database layer that talks with a database, and a component that talks to third-party API. To translate that into Spring terms, we have controller, service, repository, and some sort of an HTTP client for API calls. This will be our starting point for refactoring our one-file application to multiple components which is necessary if we want to be able to test layers of the application without too much trouble.</p><h2 id=controller>Controller<a href=#controller class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Controller extraction is probably the simplest one - we take only a declaration of the <code>@GetMapping</code> method and move it to a controller class.</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s2>&#34;/languages&#34;</span><span class=p>)</span>
<span class=nd>@RestController</span>
<span class=k>class</span> <span class=nc>LanguagesController</span> <span class=p>{</span>

    <span class=nd>@GetMapping</span>
    <span class=k>fun</span> <span class=nf>getLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span> <span class=p>{</span>

    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=service>Service<a href=#service class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>To fix the error in the controller, we will need a component that interacts with a database and external API. Create a class <code>LanguagesService</code>, annotate it with <code>@Service</code>, and copy implementation of the <code>getLanguages</code> method along with model and dependencies.</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>private</span> <span class=k>val</span> <span class=py>urls</span> <span class=p>=</span> <span class=n>mapOf</span><span class=p>(</span>
    <span class=s2>&#34;Kotlin&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/6654273e-456d-40ce-9209-c879c93a844d&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Java&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/f04c90fc-7529-4f0b-a9d7-90e92105d5bf&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Go&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/2eece29e-29d8-4d59-aa81-9d47886f2e17&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Python&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/72bbad6e-2127-4f8a-a9c1-2fdf15b0c18c&#34;</span>
<span class=p>)</span>

<span class=nd>@Service</span>
<span class=k>class</span> <span class=nc>LanguagesService</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>webClient</span><span class=p>:</span> <span class=n>WebClient</span><span class=p>,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>databaseClient</span><span class=p>:</span> <span class=n>DatabaseClient</span>
<span class=p>)</span> <span class=p>{</span>

    <span class=k>fun</span> <span class=nf>getLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>databaseClient</span><span class=p>.</span><span class=n>select</span><span class=p>().</span><span class=n>from</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>).</span><span class=nd>`as</span><span class=err>`</span><span class=p>(</span><span class=n>Language</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>).</span><span class=n>fetch</span><span class=p>().</span><span class=n>all</span><span class=p>()</span>
            <span class=p>.</span><span class=n>flatMap</span> <span class=p>{</span> <span class=n>language</span> <span class=o>-&gt;</span>
                <span class=c1>// fetch published year for each language
</span><span class=c1></span>                <span class=k>val</span> <span class=py>languageYearResponse</span> <span class=p>=</span> <span class=n>webClient</span>
                    <span class=p>.</span><span class=k>get</span><span class=p>()</span>
                    <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=n>urls</span><span class=p>[</span><span class=n>language</span><span class=p>.</span><span class=n>name</span><span class=p>].</span><span class=n>toString</span><span class=p>())</span>
                    <span class=p>.</span><span class=n>retrieve</span><span class=p>()</span>
                    <span class=p>.</span><span class=n>bodyToMono</span><span class=p>(</span><span class=n>LanguageYear</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>

                <span class=c1>// update language model with a fetched year
</span><span class=c1></span>                <span class=n>languageYearResponse</span>
                    <span class=p>.</span><span class=n>map</span> <span class=p>{</span> <span class=n>languageYear</span> <span class=o>-&gt;</span> <span class=n>language</span><span class=p>.</span><span class=n>copy</span><span class=p>(</span><span class=n>year</span> <span class=p>=</span> <span class=n>languageYear</span><span class=p>.</span><span class=n>year</span><span class=p>)</span> <span class=p>}</span>
            <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>data</span> <span class=k>class</span> <span class=nc>Language</span><span class=p>(</span>
    <span class=k>val</span> <span class=py>name</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
    <span class=k>val</span> <span class=py>year</span><span class=p>:</span> <span class=n>Int</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
<span class=p>)</span>

<span class=k>data</span> <span class=k>class</span> <span class=nc>LanguageYear</span><span class=p>(</span>
    <span class=k>val</span> <span class=py>year</span><span class=p>:</span> <span class=n>Int</span>
<span class=p>)</span>
</code></pre></div><p>Now, we can fix controller error by injecting and calling the service method:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@RequestMapping</span><span class=p>(</span><span class=s2>&#34;/languages&#34;</span><span class=p>)</span>
<span class=nd>@RestController</span>
<span class=k>class</span> <span class=nc>LanguagesController</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>languagesService</span><span class=p>:</span> <span class=n>LanguagesService</span>
<span class=p>)</span> <span class=p>{</span>

    <span class=nd>@GetMapping</span>
    <span class=k>fun</span> <span class=nf>getLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>languagesService</span><span class=p>.</span><span class=n>getLanguages</span><span class=p>()</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><h2 id=repository-and-webclient>Repository and WebClient<a href=#repository-and-webclient class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Since service class will usually contain your main business logic, you want to cover it with pure unit tests meaning there should be no external dependencies - just pure Java/Kotlin code. For that, we have to remove database and <code>WebClient</code> dependencies. For both of those, we can use interfaces that we will be able to mock in our tests.</p><p>For repository, we can have an interface and its implementation in the same file since it&rsquo;s really short, but you can also extract it to multiple files (if you are using Java, you have to):</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>interface</span> <span class=nc>LanguageRepository</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>fetchLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span>
<span class=p>}</span>

<span class=nd>@Repository</span>
<span class=k>class</span> <span class=nc>ReactiveLanguageRepository</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>databaseClient</span><span class=p>:</span> <span class=n>DatabaseClient</span>
<span class=p>)</span> <span class=p>:</span> <span class=n>LanguageRepository</span> <span class=p>{</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>fetchLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>databaseClient</span><span class=p>.</span><span class=n>select</span><span class=p>().</span><span class=n>from</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>).</span><span class=nd>`as</span><span class=err>`</span><span class=p>(</span><span class=n>Language</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>).</span><span class=n>fetch</span><span class=p>().</span><span class=n>all</span><span class=p>()</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>With this in place, we can update our service:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Service</span>
<span class=k>class</span> <span class=nc>LanguagesService</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>webClient</span><span class=p>:</span> <span class=n>WebClient</span><span class=p>,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>languageRepository</span><span class=p>:</span> <span class=n>LanguageRepository</span>
<span class=p>)</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>getLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>languageRepository</span><span class=p>.</span><span class=n>fetchLanguages</span><span class=p>()</span>
            <span class=p>.</span><span class=n>flatMap</span> <span class=p>{</span> <span class=n>language</span> <span class=o>-&gt;</span>
                <span class=c1>// fetch published year for each language
</span><span class=c1></span>                <span class=k>val</span> <span class=py>languageYearResponse</span> <span class=p>=</span> <span class=n>webClient</span>
                    <span class=p>.</span><span class=k>get</span><span class=p>()</span>
                    <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=n>urls</span><span class=p>[</span><span class=n>language</span><span class=p>.</span><span class=n>name</span><span class=p>].</span><span class=n>toString</span><span class=p>())</span>
                    <span class=p>.</span><span class=n>retrieve</span><span class=p>()</span>
                    <span class=p>.</span><span class=n>bodyToMono</span><span class=p>(</span><span class=n>LanguageYear</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>

                <span class=c1>// update language model with a fetched year
</span><span class=c1></span>                <span class=n>languageYearResponse</span>
                    <span class=p>.</span><span class=n>map</span> <span class=p>{</span> <span class=n>languageYear</span> <span class=o>-&gt;</span> <span class=n>language</span><span class=p>.</span><span class=n>copy</span><span class=p>(</span><span class=n>year</span> <span class=p>=</span> <span class=n>languageYear</span><span class=p>.</span><span class=n>year</span><span class=p>)</span> <span class=p>}</span>
            <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>One cool thing to notice here is that we don&rsquo;t care about the storage type in our service layer &ndash; this is extremely useful if a project is starting and the storage type is still unknown. You can build your whole application logic using only an interface and then plug in real implementation at the end. Also, changing storage type (or even using two in parallel) is completely transparent from the standpoint of the service itself.</p><p>For <code>WebClient</code> we can do a similar thing as for a database:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>private</span> <span class=k>val</span> <span class=py>urls</span> <span class=p>=</span> <span class=n>mapOf</span><span class=p>(</span>
    <span class=s2>&#34;Kotlin&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/6654273e-456d-40ce-9209-c879c93a844d&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Java&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/f04c90fc-7529-4f0b-a9d7-90e92105d5bf&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Go&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/2eece29e-29d8-4d59-aa81-9d47886f2e17&#34;</span><span class=p>,</span>
    <span class=s2>&#34;Python&#34;</span> <span class=n>to</span> <span class=s2>&#34;https://run.mocky.io/v3/72bbad6e-2127-4f8a-a9c1-2fdf15b0c18c&#34;</span>
<span class=p>)</span>

<span class=k>interface</span> <span class=nc>LanguageYearClient</span> <span class=p>{</span>
    <span class=k>fun</span> <span class=nf>fetchLanguageYear</span><span class=p>(</span><span class=n>language</span><span class=p>:</span> <span class=n>Language</span><span class=p>):</span> <span class=n>Mono</span><span class=p>&lt;</span><span class=n>LanguageYear</span><span class=p>&gt;</span>
<span class=p>}</span>

<span class=nd>@Component</span>
<span class=k>class</span> <span class=nc>MockyLanguageYearClient</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>webClient</span><span class=p>:</span> <span class=n>WebClient</span>
<span class=p>)</span> <span class=p>:</span> <span class=n>LanguageYearClient</span> <span class=p>{</span>

    <span class=k>override</span> <span class=k>fun</span> <span class=nf>fetchLanguageYear</span><span class=p>(</span><span class=n>language</span><span class=p>:</span> <span class=n>Language</span><span class=p>):</span> <span class=n>Mono</span><span class=p>&lt;</span><span class=n>LanguageYear</span><span class=p>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>webClient</span>
            <span class=p>.</span><span class=k>get</span><span class=p>()</span>
            <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=n>urls</span><span class=p>[</span><span class=n>language</span><span class=p>.</span><span class=n>name</span><span class=p>].</span><span class=n>toString</span><span class=p>())</span>
            <span class=p>.</span><span class=n>retrieve</span><span class=p>()</span>
            <span class=p>.</span><span class=n>bodyToMono</span><span class=p>(</span><span class=n>LanguageYear</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>One thing worth mentioning here is that a good idea is to separate your database models or third-party API models from your domain models. They usually contain information you don&rsquo;t need or you have to somehow transform it to make it useful. So, in a real-world scenario, you&rsquo;d map <code>Language</code> and <code>LanguageYears</code> in the implementation itself and expose the domain model in your interface(s).</p><p>With that in place, here&rsquo;s our final version of the service:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Service</span>
<span class=k>class</span> <span class=nc>LanguagesService</span><span class=p>(</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>languageYearClient</span><span class=p>:</span> <span class=n>LanguageYearClient</span><span class=p>,</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>languageRepository</span><span class=p>:</span> <span class=n>LanguageRepository</span>
<span class=p>)</span> <span class=p>{</span>

    <span class=k>fun</span> <span class=nf>getLanguages</span><span class=p>():</span> <span class=n>Flux</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>languageRepository</span><span class=p>.</span><span class=n>fetchLanguages</span><span class=p>()</span>
            <span class=p>.</span><span class=n>flatMap</span> <span class=p>{</span> <span class=n>language</span> <span class=o>-&gt;</span>
                <span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>language</span><span class=p>)</span>
                    <span class=p>.</span><span class=n>map</span> <span class=p>{</span> <span class=n>languageYear</span> <span class=o>-&gt;</span> <span class=n>language</span><span class=p>.</span><span class=n>copy</span><span class=p>(</span><span class=n>year</span> <span class=p>=</span> <span class=n>languageYear</span><span class=p>.</span><span class=n>year</span><span class=p>)</span> <span class=p>}</span>
            <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>And that&rsquo;s it! We have our application separated by layers that we can separately test using Spring&rsquo;s slice testing capabilities and pure JUnit tests.</p><h1 id=testing>Testing<a href=#testing class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>When it comes to testing in general, you usually start with unit tests that cover the smallest scope (a single class or a module) and are fast. This enables you to run them separately from other, bulkier tests in your CI/CD pipeline and quickly see if the application still works as expected. One step above the unit tests are integration tests that usually start the whole application and test the whole flow including things like request handling, third-party API calls, database interactions, etc. Those tests can overlap with the unit tests but are much more reliable due to the scope. When it comes to choosing which tests to write, opinions are split - some people prefer to have a large number of unit tests and not that many integration tests while others prefer more integration tests. In this section, we will see how to do both :)</p><p>Of course, those types of tests are not the only ones. There are end-to-end (E2E) tests, system tests, performance tests, functional tests, etc. but we won&rsquo;t cover those here. They usually require other frameworks, tools, and even a different skillset, while unit and integration tests are part of the standard development workflow.</p><p>Apart from unit and integration tests, Spring enables you to do so-called slice testing. This means that, instead of starting the whole Spring application context, the testing framework will start only one layer (e.g. controller layer) and enable you to issue normal HTTP requests to your endpoints while everything else is mocked. This is useful to test request/response payloads as well as error responses. Slice testing capabilities are explained in more detail <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests>here</a> so I will skip explanation in this post, but we will touch some parts of it as we test our application. More specifically, we will see how to use <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications-testing-autoconfigured-webflux-tests>WebFlux slice testing capabilities</a>. Of course, controller slice is not the only one that is available, but it&rsquo;s the one we will be using in this blog post. A list of all other slices can be found <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-testing-spring-boot-applications>here (in a sidebar)</a>.</p><p>Finally, for our integration tests, we will need a connection to a database. This is sometimes done using an in-memory instance of a database, but this is not a good solution since an in-memory database usually differs from the one used in production. This means that nobody guarantees us that the behavior we tested and verify will work in production. Ideally, we want to have the same environment in our test as well as in the production and this is possible to achieve with the library called <a href=https://www.testcontainers.org>Testcontainers</a>.</p><h2 id=controller-level-tests>Controller-level tests<a href=#controller-level-tests class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Let&rsquo;s start from the top - when a request is made, the controller is one of the first components that will be reached in the application (there&rsquo;s a lot of framework-specific code that runs before the controller is reached). Let&rsquo;s see how can slice testing on a controller level helps us here.</p><p>In the <code>src/main/test</code>, following the package structure of the source, we will create an empty class called <code>LanguagesControllerTest</code> and annotate it with <code>@WebFluxTest</code> which will auto-configure only controller-level beans. The most important bean is <code>WebTestClient</code> that allows us to perform requests to our endpoints and assert received response.</p><p>First, let&rsquo;s create some mock data. To make things shorter, we can define it as a pure Kotlin code, but it can also be read from a file or generated in any other way.</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>val</span> <span class=py>languages</span> <span class=p>=</span> <span class=n>listOf</span><span class=p>(</span>
    <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;Test language 1&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>1000</span><span class=p>),</span>
    <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;Test language 2&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2000</span><span class=p>),</span>
    <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;Test language 3&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>3000</span><span class=p>)</span>
<span class=p>)</span>
</code></pre></div><p>Next, we need dependencies that we will use in our tests: already mentioned <code>WebTestClient</code> and the mock of our <code>LanguageService</code>.</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Autowired</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>webTestClient</span><span class=p>:</span> <span class=n>WebTestClient</span>

<span class=nd>@MockBean</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>languagesService</span><span class=p>:</span> <span class=n>LanguagesService</span>
</code></pre></div><p>With the first test, we want to test that controller will return 200 and the data that the service returns. For that, we need to mock service response using <a href=https://site.mockito.org/>Mockito</a> framework. Also, we will be leveraging JUnit 5 <code>@DisplayName</code> feature to give our test descriptive names while keeping method names short. Notice that I&rsquo;ve mentioned JUnit - those tests are nothing more than a simple unit test with some additional Spring configuration.</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Test</span>
<span class=nd>@DisplayName</span><span class=p>(</span><span class=s2>&#34;Getting all languages should return 200 with the list of all languages from the service&#34;</span><span class=p>)</span>
<span class=k>fun</span> <span class=nf>getAllLanguagesTest</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languagesService</span><span class=p>.</span><span class=n>getLanguages</span><span class=p>()).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Flux</span><span class=p>.</span><span class=n>fromIterable</span><span class=p>(</span><span class=n>languages</span><span class=p>))</span>

    <span class=n>webTestClient</span>
        <span class=p>.</span><span class=k>get</span><span class=p>()</span>
        <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=s2>&#34;/languages&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>exchange</span><span class=p>()</span>
        <span class=p>.</span><span class=n>expectStatus</span><span class=p>().</span><span class=n>isOk</span>
        <span class=p>.</span><span class=n>expectBodyList</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;()</span>
        <span class=p>.</span><span class=n>contains</span><span class=p>(*</span><span class=n>languages</span><span class=p>.</span><span class=n>toTypedArray</span><span class=p>())</span>
<span class=p>}</span>
</code></pre></div><p>NOTE: If you are new to Kotlin, <code>when</code> is surrounded by backticks because it&rsquo;s one of Kotlin&rsquo;s keywords. In Java, there are no backticks.</p><p>So, we can see that the first thing we have to do is mock our service response so that it returns mocked languages we&rsquo;ve defined. Next, we have to specify an endpoint we want to test along with the method, and then we can trigger the call using the <code>exchange</code> method. If your endpoint needs specific headers, attributes, cookies, etc. there are methods to set those before calling <code>exchange</code>, but we don&rsquo;t need any of that. After a call to <code>exchange</code>, we can check the response: status, headers, and body. For the body, there are multiple options, but here we can use a simple list of assertions that will check if the response contains all the items in the provided set of arguments (<code>contains</code> methods accepts so called <code>vararg</code> so we have to convert the list to it).</p><p>If we run this test, it should be green. After that, we can change assertions so that the test fails to make sure the test it&rsquo;s working. Although this might sound weird, breaking tests on purpose is a good practice to make sure assertions we are using are doing their job.</p><p>Next, we want to test the unhappy scenario where the service returns an error.</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Test</span>
<span class=nd>@DisplayName</span><span class=p>(</span><span class=s2>&#34;Getting all languages should throw an error if service throws an error&#34;</span><span class=p>)</span>
<span class=k>fun</span> <span class=nf>getAllLanguagesErrorTest</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languagesService</span><span class=p>.</span><span class=n>getLanguages</span><span class=p>()).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Flux</span><span class=p>.</span><span class=n>error</span><span class=p>(</span><span class=n>Throwable</span><span class=p>(</span><span class=s2>&#34;My custom error&#34;</span><span class=p>)))</span>

    <span class=n>webTestClient</span>
        <span class=p>.</span><span class=k>get</span><span class=p>()</span>
        <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=s2>&#34;/languages&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>exchange</span><span class=p>()</span>
        <span class=p>.</span><span class=n>expectStatus</span><span class=p>().</span><span class=n>is5xxServerError</span>
        <span class=p>.</span><span class=n>expectBody</span><span class=p>()</span>
        <span class=p>.</span><span class=n>jsonPath</span><span class=p>(</span><span class=s2>&#34;.status&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>isEqualTo</span><span class=p>(</span><span class=m>500</span><span class=p>)</span>
        <span class=p>.</span><span class=n>jsonPath</span><span class=p>(</span><span class=s2>&#34;.error&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>isEqualTo</span><span class=p>(</span><span class=s2>&#34;Internal Server Error&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>Similar to the first test, we first have to mock the language service response, but this time it&rsquo;s some kind of an error. We could be more specific here if we need to test multiple custom errors that the service can return, but since we haven&rsquo;t set up a proper error handling, we will simply return some random <code>Throwable</code>. The next steps are the same as in the happy scenario, but assertions are a bit different. As I said, we haven&rsquo;t set up a proper error handling, so error format will be Spring&rsquo;s default that looks like this:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
 <span class=nt>&#34;error&#34;</span><span class=p>:</span> <span class=s2>&#34;Internal Server Error&#34;</span><span class=p>,</span>
 <span class=nt>&#34;message&#34;</span><span class=p>:</span> <span class=kc>null</span><span class=p>,</span>
 <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/languages&#34;</span><span class=p>,</span>
 <span class=nt>&#34;requestId&#34;</span><span class=p>:</span> <span class=s2>&#34;04445bdd-1&#34;</span><span class=p>,</span>
 <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=mi>500</span><span class=p>,</span>
 <span class=nt>&#34;timestamp&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-08-06T01:33:44.762+00:00&#34;</span>
<span class=p>}</span>
</code></pre></div><p>We can see that there&rsquo;s a <code>requestId</code> and a <code>timestamp</code> meaning it&rsquo;s hard to match the whole JSON similarly to how we did it with the language&rsquo;s response. Luckily, Spring gives us the option to inspect parts of the JSON using <a href=https://goessner.net/articles/JsonPath/>JSONPath</a>. With it, we check the <code>status</code> and <code>error</code> values and confirm they are what we expect them to be.</p><p>And that&rsquo;s it when it comes to controller-level tests. In a real project, this is the place where you would test if controllers are properly handling invalid request bodies, missing headers, query parameters, or improperly formatted path parameters (e.g. UUID) and if responses that they produce are following a specification.</p><h2 id=unit-testing>Unit testing<a href=#unit-testing class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>We&rsquo;ve seen unit testing in action above and it will be very similar when done on a service level. What&rsquo;s important to notice here is that our service does not depend on any Spring dependencies (we can ignore <code>@Service</code> since it&rsquo;s used for dependency injection) which means our unit (or, rather, JUnit) tests do not require any specific annotations or injected dependencies. The only thing that is different from a unit test in codebases that do not use reactive programming is how to trigger execution and assert that received data is correct.</p><p>Before we start writing our first unit test, we need to add testing support for Reactor:</p><div class=highlight><pre class=chroma><code class=language-groovy data-lang=groovy><span class=n>testImplementation</span><span class=o>(</span><span class=s2>&#34;io.projectreactor:reactor-test&#34;</span><span class=o>)</span>
</code></pre></div><p>The basic outline of our <code>LanguagesService</code> class will look like this:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=k>class</span> <span class=nc>LanguagesServiceTest</span> <span class=p>{</span>

    <span class=k>private</span> <span class=k>val</span> <span class=py>languageRepository</span><span class=p>:</span> <span class=n>LanguageRepository</span> <span class=p>=</span> <span class=n>mock</span><span class=p>(</span><span class=n>LanguageRepository</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>
    <span class=k>private</span> <span class=k>val</span> <span class=py>languageYearClient</span><span class=p>:</span> <span class=n>LanguageYearClient</span> <span class=p>=</span> <span class=n>mock</span><span class=p>(</span><span class=n>LanguageYearClient</span><span class=o>::</span><span class=k>class</span><span class=p>.</span><span class=n>java</span><span class=p>)</span>

    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>languagesService</span><span class=p>:</span> <span class=n>LanguagesService</span>

    <span class=nd>@BeforeEach</span>
    <span class=k>fun</span> <span class=nf>setUp</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>languagesService</span> <span class=p>=</span> <span class=n>LanguagesService</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>,</span> <span class=n>languageRepository</span><span class=p>)</span>
    <span class=p>}</span>

    <span class=nd>@Test</span>
    <span class=nd>@DisplayName</span><span class=p>(</span><span class=s2>&#34;Get languages should return combination of stored names and fetched years&#34;</span><span class=p>)</span>
    <span class=k>fun</span> <span class=nf>getLanguagesTest</span><span class=p>()</span> <span class=p>{</span>
        
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>We declare service dependencies as mocks, before each test we create a fresh instance of a <code>LangaguesService</code> and we define a method for our first test, again, leveraging JUnit 5 <code>@DisplayName</code>.</p><p>Next step would be to mock return data for a repository and a client:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageRepository</span><span class=p>.</span><span class=n>fetchLanguages</span><span class=p>()).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Flux</span><span class=p>.</span><span class=n>fromIterable</span><span class=p>(</span><span class=n>languages</span><span class=p>))</span>
<span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>any</span><span class=p>())).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=n>just</span><span class=p>(</span><span class=n>LanguageYear</span><span class=p>(</span><span class=m>2000</span><span class=p>)))</span>
</code></pre></div><p>There&rsquo;s nothing Reactor-specific here, just a simple mocking using a Mockito framework that ships with Spring. Now, we can finally execute the method we want to test and check if the results are correct. The full test now looks like this:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Test</span>
<span class=nd>@DisplayName</span><span class=p>(</span><span class=s2>&#34;Get languages should return combination of stored names and fetched years&#34;</span><span class=p>)</span>
<span class=k>fun</span> <span class=nf>getLanguagesTest</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageRepository</span><span class=p>.</span><span class=n>fetchLanguages</span><span class=p>()).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Flux</span><span class=p>.</span><span class=n>fromIterable</span><span class=p>(</span><span class=n>languages</span><span class=p>))</span>
    <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>any</span><span class=p>())).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=n>just</span><span class=p>(</span><span class=n>LanguageYear</span><span class=p>(</span><span class=m>2000</span><span class=p>)))</span>

    <span class=k>val</span> <span class=py>expectedLanguages</span> <span class=p>=</span> <span class=n>listOf</span><span class=p>(</span>
        <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;Test language 1&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2000</span><span class=p>),</span>
        <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;Test language 2&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2000</span><span class=p>),</span>
        <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;Test language 3&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2000</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>StepVerifier</span><span class=p>.</span><span class=n>create</span><span class=p>(</span><span class=n>languagesService</span><span class=p>.</span><span class=n>getLanguages</span><span class=p>())</span>
        <span class=p>.</span><span class=n>expectNextSequence</span><span class=p>(</span><span class=n>expectedLanguages</span><span class=p>)</span>
        <span class=p>.</span><span class=n>verifyComplete</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div><p>So, instead of calling a method, storing a result to a variable, and then asserting whatever conditions we want, we use <code>StepVerifier.create</code> to define what method we want to tests, and we use a few of the methods from <code>expect*</code> family and finalizing a test with a call to <code>verify</code>. This might not be obvious, but if you check <code>verifyComplete()</code> it&rsquo;s a combination of two calls <code>expectComplete()</code> and <code>verify()</code>. There&rsquo;s a bunch of other methods to verify expected results, you can create your publisher to control when data is emitted and you can even control time if you are testing time-sensitive operations. More about all those listed topics can be found in the <a href=https://projectreactor.io/docs/core/release/reference/#testing>offical documentation</a>.</p><p>NOTE: <code>any()</code> used in the code above is from <a href=https://github.com/nhaarman/mockito-kotlin><code>mockito-kotlin</code></a> library since Mockito&rsquo;s matchers do not work properly with Kotlin. For Java, anything from Mockito will work perfectly fine.</p><h2 id=integration-testing>Integration testing<a href=#integration-testing class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>The idea of the integration testing is to start all the components of your application and test the whole flow starting with an HTTP call and executing all actions on those components. Those tests give us more confidence that our service works as it should, but are also much slower than pure unit tests. So, how can we start all components of our application and perform validations on them? When it comes to the Spring application, there&rsquo;s <code>@SpringBootTest</code> annotation that can start the whole application, create all the beans and prepare them for injection. The only thing left is to figure out how to use a database that will be used in the production.</p><h3 id=testcontainers>Testcontainers<a href=#testcontainers class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p><a href=https://www.testcontainers.org/>Testcontainers</a> is a library that enables you to run any dependency your application needs as a Docker container giving it an ability to use the same environment that will be used in production.</p><p>Before I continue forward, I have to say that <a href=https://github.com/bsideup>Sergei</a> (one of the top contributors) is active in the community (StackOverflow, Slack, Twitter, conferences) and he has few good resources about this library as well as the whole reactive programming paradigm so check him out :)</p><p>Since Testcontainers is a topic that can span through multiple blog posts, I&rsquo;ll try and keep it as short and as simple as possible. We will go through a simple example that will start up a PostgreSQL database and keep it running for the whole test suite (one class) that will consist of multiple integration tests verifying the functionality of our application.</p><p>To start using Testcontainers with PostgreSQL database with R2DBC and JUnit 5, we need these dependencies:</p><div class=highlight><pre class=chroma><code class=language-groovy data-lang=groovy><span class=n>testImplementation</span><span class=o>(</span><span class=s2>&#34;org.testcontainers:testcontainers:1.15.2&#34;</span><span class=o>)</span>
<span class=n>testImplementation</span><span class=o>(</span><span class=s2>&#34;org.testcontainers:junit-jupiter:1.15.2&#34;</span><span class=o>)</span>
<span class=n>testImplementation</span><span class=o>(</span><span class=s2>&#34;org.testcontainers:postgresql:1.15.2&#34;</span><span class=o>)</span>
<span class=n>testImplementation</span><span class=o>(</span><span class=s2>&#34;org.testcontainers:r2dbc:1.15.2&#34;</span><span class=o>)</span>
</code></pre></div><p>and now we can create a full integration test suite step-by-step and explain what each of those dependencies gives us.</p><h3 id=test-setup>Test setup<a href=#test-setup class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Let&rsquo;s start by simply defining a test class:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span> <span class=p>=</span> <span class=n>SpringBootTest</span><span class=p>.</span><span class=n>WebEnvironment</span><span class=p>.</span><span class=n>RANDOM_PORT</span><span class=p>)</span>
<span class=nd>@Testcontainers</span>
<span class=k>class</span> <span class=nc>LanguagesIntegrationTest</span> <span class=p>{</span>

<span class=p>}</span>
</code></pre></div><p>We have a standard Spring annotation that will run complete application context and start serving our endpoints on a random port. Next, we have <code>@Testcontainers</code> annotation which comes from the <code>org.testcontainers.junit.jupiter</code> package and it enables us to use JUnit 5 framework.</p><p>The really nice thing with Testcontainers, databases, and R2DBC is that you need only a small change in your <code>application.properties</code> file to run your test database &ndash; you need to add <code>tc</code> between driver and database name in the URL to the database and you have to specify image version you want to use.</p><pre><code>spring.r2dbc.url=r2dbc:tc:postgresql://localhost:5432/webflux-demo-database?TC_IMAGE_TAG=13.2-alpine
</code></pre><p>For Testcontainers to pull an image and start a container, you have to have some database operations in your code. To start, we can add a code that we want to execute before each test that will fill a database with some mock data:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin>
<span class=nd>@Autowired</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>databaseClient</span><span class=p>:</span> <span class=n>DatabaseClient</span>

<span class=nd>@BeforeEach</span>
<span class=k>fun</span> <span class=nf>setUp</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// create table on the first run
</span><span class=c1></span>    <span class=n>databaseClient</span><span class=p>.</span><span class=n>execute</span><span class=p>(</span><span class=s>&#34;&#34;&#34;
</span><span class=s>        CREATE TABLE IF NOT EXISTS languages (
</span><span class=s>            name text NOT NULL,
</span><span class=s>            year integer
</span><span class=s>        );
</span><span class=s>    &#34;&#34;&#34;</span><span class=p>.</span><span class=n>trimIndent</span><span class=p>()</span>
    <span class=p>).</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
    <span class=c1>// delete all data from previous run
</span><span class=c1></span>    <span class=n>databaseClient</span><span class=p>.</span><span class=n>delete</span><span class=p>().</span><span class=n>from</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>).</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
    <span class=c1>// insert new mock data
</span><span class=c1></span>    <span class=n>databaseClient</span><span class=p>.</span><span class=n>insert</span><span class=p>()</span>
        <span class=p>.</span><span class=n>into</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>value</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;test 1&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
    <span class=n>databaseClient</span><span class=p>.</span><span class=n>insert</span><span class=p>()</span>
        <span class=p>.</span><span class=n>into</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>value</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;test 2&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
<span class=p>}</span>
</code></pre></div><p>Notice usage of <code>block</code> here. Since we are now testing, we need database operations to execute immediately instead of running them when needed as we do with normal <code>Mono</code> or <code>Flux</code> types. Also, batch inserts are not possible with <code>DatabaseClient</code> so we have to execute multiple insert statements. Now, we also need a dummy test:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Test</span>
<span class=k>fun</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>Assertions</span><span class=p>.</span><span class=n>assertThat</span><span class=p>(</span><span class=m>1</span><span class=p>).</span><span class=n>isEqualTo</span><span class=p>(</span><span class=m>1</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>With all this in place, we can run our tests. The first run will take a bit longer (depending on your Internet connection) since it will pull Docker image locally, but the next runs will be faster.</p><p>If this works, we can continue with proper testing. For our test, we will need our old friend <code>WebTestClient</code> (the same one we used in controller slice testing):</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Autowired</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>webTestClient</span><span class=p>:</span> <span class=n>WebTestClient</span>
</code></pre></div><p>And now, I have to say that I&rsquo;ve been lying a bit when I said that we will do integration testing without mocking anything. Calls towards third-party API are something that we can mock since we don&rsquo;t want our tests to depend on it working. For this blog post, I&rsquo;ll stick with Mockito and mock our <code>LanguageYearClient</code> interface, but another option would be to use something like <a href=https://www.mock-server.com>MockServer</a> or <a href=http://wiremock.org>WireMock</a>. With that being said, here&rsquo;s our mocked interface:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@MockBean</span>
<span class=k>lateinit</span> <span class=k>var</span> <span class=py>languageYearClient</span><span class=p>:</span> <span class=n>LanguageYearClient</span>
</code></pre></div><p>We now have everything we need to write our integration test that will call an endpoint and verify that it returns data we&rsquo;ve inserted into a database along with data we will mock in the test itself representing third-party API response. Oh, and we can remove our dummy that that verifies 1 == 1 :)</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@Test</span>
<span class=nd>@DisplayName</span><span class=p>(</span><span class=s2>&#34;Getting all languages should return 200 with the list of all languages with correct years&#34;</span><span class=p>)</span>
<span class=k>fun</span> <span class=nf>getAllLanguagesTest</span><span class=p>()</span> <span class=p>{</span>
    <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 1&#34;</span><span class=p>))).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=n>just</span><span class=p>(</span><span class=n>LanguageYear</span><span class=p>(</span><span class=m>2010</span><span class=p>)))</span>
    <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 2&#34;</span><span class=p>))).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=n>just</span><span class=p>(</span><span class=n>LanguageYear</span><span class=p>(</span><span class=m>2020</span><span class=p>)))</span>
    <span class=n>webTestClient</span>
        <span class=p>.</span><span class=k>get</span><span class=p>()</span>
        <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=s2>&#34;/languages&#34;</span><span class=p>)</span>
        <span class=p>.</span><span class=n>exchange</span><span class=p>()</span>
        <span class=p>.</span><span class=n>expectStatus</span><span class=p>().</span><span class=n>isOk</span>
        <span class=p>.</span><span class=n>expectBodyList</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;()</span>
        <span class=p>.</span><span class=n>contains</span><span class=p>(*</span><span class=n>listOf</span><span class=p>(</span>
            <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 1&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2010</span><span class=p>),</span>
            <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 2&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2020</span><span class=p>)</span>
        <span class=p>).</span><span class=n>toTypedArray</span><span class=p>())</span>
<span class=p>}</span>
</code></pre></div><p>The only weird piece of code here is an argument of the <code>contains</code> method which is a so-called spread operator that converts a list to a variable number of arguments (<code>vararg</code>).</p><p>When you run this, the test should be green and, of course, you should try changing mocked years or response structure to make sure tests are then failing. And this is it, our complete integration testing class should now look like this:</p><div class=highlight><pre class=chroma><code class=language-kotlin data-lang=kotlin><span class=nd>@SpringBootTest</span><span class=p>(</span><span class=n>webEnvironment</span> <span class=p>=</span> <span class=n>SpringBootTest</span><span class=p>.</span><span class=n>WebEnvironment</span><span class=p>.</span><span class=n>RANDOM_PORT</span><span class=p>)</span>
<span class=nd>@Testcontainers</span>
<span class=k>class</span> <span class=nc>LanguagesIntegrationTest</span> <span class=p>{</span>

    <span class=nd>@Autowired</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>webTestClient</span><span class=p>:</span> <span class=n>WebTestClient</span>

    <span class=nd>@MockBean</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>languageYearClient</span><span class=p>:</span> <span class=n>LanguageYearClient</span>

    <span class=nd>@Autowired</span>
    <span class=k>lateinit</span> <span class=k>var</span> <span class=py>databaseClient</span><span class=p>:</span> <span class=n>DatabaseClient</span>

    <span class=nd>@BeforeEach</span>
    <span class=k>fun</span> <span class=nf>setUp</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// create table on the first run
</span><span class=c1></span>        <span class=n>databaseClient</span><span class=p>.</span><span class=n>execute</span><span class=p>(</span><span class=s>&#34;&#34;&#34;
</span><span class=s>            CREATE TABLE IF NOT EXISTS languages (
</span><span class=s>                name text NOT NULL,
</span><span class=s>                year integer
</span><span class=s>            );
</span><span class=s>        &#34;&#34;&#34;</span><span class=p>.</span><span class=n>trimIndent</span><span class=p>()</span>
        <span class=p>).</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
        <span class=c1>// delete all data from previous run
</span><span class=c1></span>        <span class=n>databaseClient</span><span class=p>.</span><span class=n>delete</span><span class=p>().</span><span class=n>from</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>).</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
        <span class=c1>// insert new mock data
</span><span class=c1></span>        <span class=n>databaseClient</span><span class=p>.</span><span class=n>insert</span><span class=p>()</span>
            <span class=p>.</span><span class=n>into</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>value</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;test 1&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
        <span class=n>databaseClient</span><span class=p>.</span><span class=n>insert</span><span class=p>()</span>
            <span class=p>.</span><span class=n>into</span><span class=p>(</span><span class=s2>&#34;languages&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>value</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,</span> <span class=s2>&#34;test 2&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>then</span><span class=p>().</span><span class=n>block</span><span class=p>()</span>
    <span class=p>}</span>

    <span class=nd>@Test</span>
    <span class=nd>@DisplayName</span><span class=p>(</span><span class=s2>&#34;Getting all languages should return 200 with the list of all languages with correct years&#34;</span><span class=p>)</span>
    <span class=k>fun</span> <span class=nf>getAllLanguagesTest</span><span class=p>()</span> <span class=p>{</span>
        <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 1&#34;</span><span class=p>))).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=n>just</span><span class=p>(</span><span class=n>LanguageYear</span><span class=p>(</span><span class=m>2010</span><span class=p>)))</span>
        <span class=nd>`when</span><span class=err>`</span><span class=p>(</span><span class=n>languageYearClient</span><span class=p>.</span><span class=n>fetchLanguageYear</span><span class=p>(</span><span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 2&#34;</span><span class=p>))).</span><span class=n>thenReturn</span><span class=p>(</span><span class=n>Mono</span><span class=p>.</span><span class=n>just</span><span class=p>(</span><span class=n>LanguageYear</span><span class=p>(</span><span class=m>2020</span><span class=p>)))</span>
        <span class=n>webTestClient</span>
            <span class=p>.</span><span class=k>get</span><span class=p>()</span>
            <span class=p>.</span><span class=n>uri</span><span class=p>(</span><span class=s2>&#34;/languages&#34;</span><span class=p>)</span>
            <span class=p>.</span><span class=n>exchange</span><span class=p>()</span>
            <span class=p>.</span><span class=n>expectStatus</span><span class=p>().</span><span class=n>isOk</span>
            <span class=p>.</span><span class=n>expectBodyList</span><span class=p>&lt;</span><span class=n>Language</span><span class=p>&gt;()</span>
            <span class=p>.</span><span class=n>contains</span><span class=p>(*</span><span class=n>listOf</span><span class=p>(</span>
                <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 1&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2010</span><span class=p>),</span>
                <span class=n>Language</span><span class=p>(</span><span class=n>name</span> <span class=p>=</span> <span class=s2>&#34;test 2&#34;</span><span class=p>,</span> <span class=n>year</span> <span class=p>=</span> <span class=m>2020</span><span class=p>)</span>
            <span class=p>).</span><span class=n>toTypedArray</span><span class=p>())</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>The final version of the code can be found <a href=https://github.com/mister11/webflux-demo/tree/step6_testing>here</a>. It contains 3 commits that follow steps explained in this blog post starting from refactoring to a testable code, followed by unit tests, and then integration tests at the end.</p><h1 id=conclusion>Conclusion<a href=#conclusion class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h1><p>As I said at the beginning, this blog post wraps up the whole reactive paradigm series as we&rsquo;ve covered most of the basics need for anybody to start trying out this (no so) new approach to programming. Since this whole series might become a bit outdated as time goes by, I&rsquo;ll try to update the codebase to reflect any changes and track all changes in some sort of a changelog in the project&rsquo;s README and I will add a note at the top of the blog post that leads to it.</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>4043 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>24 Feb 2021</p></footer></article><div class="post-nav thin"><a class=prev-post href=https://mister11.github.io/posts/spring_webflux/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Spring WebFlux Introduction</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2021 <a href=https://mister11.github.io/>Sven Vidak</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://mister11.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://mister11.github.io/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-153557863-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>